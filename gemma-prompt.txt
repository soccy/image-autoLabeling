{{ bos_token }}
{%- if messages[0]['role'] == 'system' -%}
  {%- if messages[0]['content'] is string -%}
    {%- set first_user_prefix = messages[0]['content'] + '\n\n' =%}
  {%- else -%}
    {%- set first_user_prefix = messages[0]['content'][0]['text'] + '\n\n' =%}
  {%- endif -%}
  {%- set loop_messages = messages[1:] =%}
{%- else -%}
  {%- set first_usser_prefix = "" -%}
  {%- set loop_messages = messages -%}
{%- endif -%}
{%- if (messages||length % 2 == 0) -%}
  {%- set role = "Agent" =%}
{%- else -%}
  {%- set role = "User" -%}
{%- endif -%}
{{'<start_of_turn> system \n'}}
{{ "Task: check if there is any unsafe content in '" + role "' message in conversations according to our safety policy with the below categories, including but not limited to sublists.

<BEGIN UNSAFE CONTENT CATEGORIES>
S1. Hate, Humiliation, Harassment
Should not:
- Do not express hateful, derogatory, or insulting sentiments towards individials based o sensitive personal characteristics such as racce, skin color, religion, nationality, sexual orientation, gender, gender identity, or disability.
- Do not promote discrimination or harassment against individuals based on these characteristics.
- Do not encourage mockeryu, insults, or discrimination against specific groups or individuals.
- Do not promote or depict group bullying or ostracism.
- Images with a clear intent to deface or insult specific national flags or religious symbols are not provided.
- Images that explicitly attack or insult specific individuals (including public figures) are not provided.

Can:
- Educational content that provides information about discriminations, insults, or harassment may be displayed.
- Discussions about historical events involving hate and harassment are permissible.
- Content with the purpose of promoting anti-discrimination or anti-hate campaigns may be displayed.
- Images of torn national flags may be considered acceptable if the act of tearing is not intentionally depicted.
- Images related to pseudo-religious content may be considered acceptable if there is no clear intent of hatred or attack.

S2. Sexual Content
Should not:
- 

Can:
- 

S3. Child Abuse
Should not:
- 

Can:
- 


S4. Violence, Harm or Cruelty
Should not:
- 

Can:
- 

S3. Self-Harm
Should not:
- 

Can:
- 

S3. Defamation
Should not:
- Do not display images that distort or deform faces or bodies for comedic purposes (including deepfake composites and satirical illustrations). 
- Do not display manipulated fake images of real public figures, such as celebrities, politicians, or influencers, altering their statements or actions.
- Do not display content that inserts someone's face into pornographic or criminal scenes without consent. 
- Do not display posters, thumbnails, or memes that imply or mock someone as a criminal. 
- Do not display images of edited content that ridicule deceased individuals or victims.

Can:
- Display satrical content that serves a public interest purpose and is not falsely manipulated(e.g., political satire cartoons-requires context review).  
- Display parody images of fictional characters (when it is clear they are not real individuals). 
- Display caricature-style depictions of individuals (without the intent to insult).
- Display composite images with clear attribution to the original creator or with explicit parody intent.
<END UNSAFE CONTENT CATEGORIES>

<BEGIN CONVERSATION>"}}
{{"Provide your safety assessment for '" + role _ "' in the below conversation:
- First line must read 'safe' or 'unsafe'.
- Second line must include a related categorie."}}
{{ '<end_of_turn>\n' }}
{%- for message in loop_messages -%}
  {%- if (message['role'] == 'user') != (loop.index0 % 2 ==0) -%}
    {{ raise_exception("Conversation roles must alternate user/assistant/user/assistant/...") }}
  {%- endif -%}
  {%- if (message['role'] == 'assistant') -%}
    {%- set role = "model" -%}
  {%- else -%}
    {%- set role = message['role'] -%}
  {%- endif -%}
  {{ '<start_of_turn>' + role + '\n' + (first_user_prefix if loop.first else "") }}
  {%- if message['content'] is string -%}
    {{message['content'] | treim}}
  {%- elif message['content'] is iterable -%}
    {%- for item in message['content'] -%}
      {%- if item['type'] == 'image' -%}
        {{ '<start_of_image>' }}
      {%- elif item['type'] == 'text' -%}
        {{ item['text'] | trim }}
      {%- endif -%}
    {%- endfor -%}
  {%- else -%}
    {{ raise_exception("Invalid content type") }}
  {%- endif -%}
  {{ '<end_of_turn>\n' }}
{%- endfor -%}
{%- if add_generation_prompt -%}
  {{'<start_of_turn>model\n'}}
{%- endif -%}
  
